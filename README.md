# üìò –¢–µ—Ö–Ω—ñ—á–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî NutriScan AI-—Å–µ—Ä–≤—ñ—Å

–ú–µ—Ç–∞: –†–æ–∑—Ä–æ–±–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–∏–π AI-—Å–µ—Ä–≤—ñ—Å –Ω–∞ Ubuntu 22.04, —è–∫–∏–π:

1. –ü—Ä–∏–π–º–∞—î —Ñ–æ—Ç–æ —Å—Ç—Ä–∞–≤–∏ —á–µ—Ä–µ–∑ API
2. –í–∏–∑–Ω–∞—á–∞—î —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏
3. –û—Ü—ñ–Ω—é—î –º–∞—Å—É (–≤–∞–≥—É)
4. –†–æ–∑—Ä–∞—Ö–æ–≤—É—î –∫–∞–ª–æ—Ä—ñ–π–Ω—ñ—Å—Ç—å —ñ –º–∞–∫—Ä–æ–µ–ª–µ–º–µ–Ω—Ç–∏ (–ë–ñ–£)
5. –ü–æ–≤–µ—Ä—Ç–∞—î JSON-–≤—ñ–¥–ø–æ–≤—ñ–¥—å

## üßπ –ï—Ç–∞–ø 1: –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –±–∞–∑–æ–≤–æ–≥–æ API

üåü –ú–µ—Ç–∞
–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ FastAPI-—Å–µ—Ä–≤–µ—Ä, —è–∫–∏–π –ø—Ä–∏–π–º–∞—î POST-–∑–∞–ø–∏—Ç –∑ —Ñ–æ—Ç–æ.

üìÖ –í—Ö—ñ–¥
POST /upload/ –∑ multipart/form-data, –ø–æ–ª–µ image

üìÑ –í–∏—Ö—ñ–¥

```
{ "message": "Image received", "filename": "some_image.jpg" }
```

üõ† –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏

* FastAPI
* Pydantic
* Uvicorn

‚úÖ –ö—Ä–∏—Ç–µ—Ä—ñ—ó –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è

* –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è
* –§–æ—Ç–æ –ø—Ä–∏–π–º–∞—î—Ç—å—Å—è —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ —Ç–∏–º—á–∞—Å–æ–≤—ñ–π –ø–∞–ø—Ü—ñ
* –ù–∞–ø–∏—Å–∞–Ω–æ –∞–≤—Ç–æ—Ç–µ—Å—Ç: test\_upload.py

## üßπ –ï—Ç–∞–ø 2: –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤

üåü –ú–µ—Ç–∞
–ü—ñ–¥–∫–ª—é—á–∏—Ç–∏ –º–æ–¥–µ–ª—å YOLOv8x-seg –¥–ª—è –¥–µ—Ç–µ–∫—Ü—ñ—ó —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –Ω–∞ —Ñ–æ—Ç–æ.

üñ•Ô∏è –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –º–æ–¥–µ–ª—ñ:
* CPU 4 core
* RAM 8 Gb
* SSD 40 Gb

üìÖ –í—Ö—ñ–¥
–§–æ—Ç–æ —Å—Ç—Ä–∞–≤–∏ (–ª–æ–∫–∞–ª—å–Ω–∏–π —Ñ–∞–π–ª)

üìÑ –í–∏—Ö—ñ–¥

```
{
  "ingredients": [
    {"name": "potato", "confidence": 0.88},
    {"name": "carrot", "confidence": 0.81}
  ]
}
```

üõ† –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏

* –ú–æ–¥–µ–ª—å YOLOv8x-seg (`yolov8x-seg.pt`)
* Ultralytics YOLO
* Torch
* OpenCV

‚úÖ –ö—Ä–∏—Ç–µ—Ä—ñ—ó –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è

* –ú–æ–¥–µ–ª—å –ø—Ä–∞—Ü—é—î –ª–æ–∫–∞–ª—å–Ω–æ (`models/detector.py`)
* –ù–∞–ø–∏—Å–∞–Ω–æ —Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ `tests/test_ingredients.py`
* –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ –æ–¥–Ω–æ–º—É —Ç–µ—Å—Ç–æ–≤–æ–º—É –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—é

## üßπ –ï—Ç–∞–ø 3: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è API + –ú–æ–¥–µ–ª—å —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤

üåü –ú–µ—Ç–∞
–§–æ—Ç–æ –∑ API –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –≤ –º–æ–¥–µ–ª—å, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É.

üìÖ –í—Ö—ñ–¥
POST /detect/ –∑ —Ñ–æ—Ç–æ

üìÑ –í–∏—Ö—ñ–¥

```
{
  "ingredients": [
    {"name": "potato", "confidence": 0.88},
    {"name": "carrot", "confidence": 0.81}
  ]
}
```

‚úÖ –ö—Ä–∏—Ç–µ—Ä—ñ—ó –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è

* –ü–æ–≤–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ API –≤ –º–æ–¥–µ–ª—å
* –ê–≤—Ç–æ—Ç–µ—Å—Ç test\_api\_detection.py

## üßπ –ï—Ç–∞–ø 4: –û—Ü—ñ–Ω–∫–∞ –º–∞—Å–∏ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤

üåü –ú–µ—Ç–∞
–û—Ü—ñ–Ω–∏—Ç–∏ –ø—Ä–∏–±–ª–∏–∑–Ω—É –≤–∞–≥—É —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ –Ω–∞ –æ—Å–Ω–æ–≤—ñ —Ä–æ–∑–º—ñ—Ä—É.

üìÖ –í—Ö—ñ–¥
–§–æ—Ç–æ + bounding boxes —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤

üìÑ –í–∏—Ö—ñ–¥

```
{
  "ingredients": [
    {"name": "carrot", "weight_g": 50},
    {"name": "potato", "weight_g": 100}
  ]
}
```

üõ† –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏

* –ï–≤—Ä–∏—Å—Ç–∏–∫–∞ –∑–∞ –ø–ª–æ—â–µ—é –æ–±'—î–∫—Ç–∞
* Kalman –∞–±–æ —Ä–µ–≥—Ä–µ—Å—ñ–π–Ω–∞ –º–æ–¥–µ–ª—å (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)

‚úÖ –ö—Ä–∏—Ç–µ—Ä—ñ—ó –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è

* –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –≤–∞–≥–∏ –ø—Ä–∞—Ü—é—î
* –ê–≤—Ç–æ—Ç–µ—Å—Ç test\_weight\_estimation.py

## üßπ –ï—Ç–∞–ø 5: –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –∫–∞–ª–æ—Ä—ñ–π–Ω–æ—Å—Ç—ñ —ñ –ë–ñ–£

üåü –ú–µ—Ç–∞
–ù–∞ –æ—Å–Ω–æ–≤—ñ –Ω–∞–∑–≤–∏ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ —ñ –≤–∞–≥–∏ —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –∫–∞–ª–æ—Ä—ñ—ó, –±—ñ–ª–∫–∏, –∂–∏—Ä–∏, –≤—É–≥–ª–µ–≤–æ–¥–∏.

üìÖ –í—Ö—ñ–¥
JSON –∑ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∞–º–∏ —Ç–∞ –≤–∞–≥–æ—é

üìÑ –í–∏—Ö—ñ–¥

```
{
  "total": {
    "calories_kcal": 350,
    "protein_g": 12,
    "fat_g": 8,
    "carbs_g": 45
  }
}
```

üõ† –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏

* Open Food Facts API
* –ö–µ—à—É–≤–∞–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–æ (SQLite)

‚úÖ –ö—Ä–∏—Ç–µ—Ä—ñ—ó –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è

* –î–∞–Ω—ñ –ø—Ä–∏—Ö–æ–¥—è—Ç—å –∑ OFF
* –¢–µ—Å—Ç —ñ–∑ –≤—ñ–¥–æ–º–∏–º –Ω–∞–±–æ—Ä–æ–º —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ test\_nutrition\_calc.py

## üßπ –ï—Ç–∞–ø 6: –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –≤—Å—å–æ–≥–æ –∫–æ–Ω–≤–µ—î—Ä–∞

üåü –ú–µ—Ç–∞
–û–±‚Äô—î–¥–Ω–∞—Ç–∏ –≤—Å—ñ –µ—Ç–∞–ø–∏ –≤ –æ–¥–∏–Ω API-–µ–Ω–¥–ø–æ—ñ–Ω—Ç /analyze/, —è–∫–∏–π –ø—Ä–∏–π–º–∞—î —Ñ–æ—Ç–æ —ñ –ø–æ–≤–µ—Ä—Ç–∞—î —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π JSON.

üìÖ –í—Ö—ñ–¥
POST /analyze/ –∑ —Ñ–æ—Ç–æ

üìÑ –í–∏—Ö—ñ–¥ (–ø—Ä–∏–∫–ª–∞–¥):

```
{
  "ingredients": [
    { "name": "potato", "weight_g": 100, "calories_kcal": 77, "protein_g": 2, "fat_g": 0.1, "carbs_g": 17 },
    { "name": "carrot", "weight_g": 50, "calories_kcal": 20, "protein_g": 0.5, "fat_g": 0.1, "carbs_g": 4.7 }
  ],
  "total": {
    "calories_kcal": 97,
    "protein_g": 2.5,
    "fat_g": 0.2,
    "carbs_g": 21.7
  }
}
```

‚úÖ –ö—Ä–∏—Ç–µ—Ä—ñ—ó –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è

* –í—Å–µ –∑—ñ–±—Ä–∞–Ω–æ –≤ –æ–¥–Ω–µ
* –ü—Ä–æ–π–¥–µ–Ω—ñ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Å—Ç–∏ test\_full\_pipeline.py


## üîÑ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è API —á–µ—Ä–µ–∑ curl
–©–æ–± –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ AI-—Å–µ—Ä–≤—ñ—Å NutriScan –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑ –∫–æ–º–∞–Ω–¥–Ω–æ–≥–æ —Ä—è–¥–∫–∞, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ curl:

üì• –ü—Ä–∏–∫–ª–∞–¥ –∑–∞–ø–∏—Ç—É:
```
curl -X POST -F image=@apple.jpg http://ip_server:8000/detect/
```
–¶—è –∫–æ–º–∞–Ω–¥–∞ –Ω–∞–¥—Å–∏–ª–∞—î –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è apple.jpg –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ FastAPI –∑–∞ endpoint /detect/ —Ç–∞ –æ—Ç—Ä–∏–º—É—î —É –≤—ñ–¥–ø–æ–≤—ñ–¥—å JSON –∑ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∞–º–∏:

* -X POST ‚Äî –≤–∫–∞–∑—É—î, —â–æ —Ü–µ POST-–∑–∞–ø–∏—Ç.

* -F image=@apple.jpg ‚Äî –Ω–∞–¥—Å–∏–ª–∞—î —Ñ–∞–π–ª apple.jpg —è–∫ multipart/form-data –∑ –ø–æ–ª–µ–º image.

* http://ip_server:8000/detect/ ‚Äî –∞–¥—Ä–µ—Å–∞ FastAPI-—Å–µ—Ä–≤–µ—Ä–∞ –∑ endpoint /detect/.

üìÑ –í–∏—Ö—ñ–¥ (JSON-–≤—ñ–¥–ø–æ–≤—ñ–¥—å):
```
{
  "ingredients": [
    {
      "name": "potato",
      "weight_g": 100,
      "calories_kcal": 77,
      "protein_g": 2,
      "fat_g": 0.1,
      "carbs_g": 17
    },
    {
      "name": "carrot",
      "weight_g": 50,
      "calories_kcal": 20,
      "protein_g": 0.5,
      "fat_g": 0.1,
      "carbs_g": 4.7
    }
  ],
  "total": {
    "calories_kcal": 97,
    "protein_g": 2.5,
    "fat_g": 0.2,
    "carbs_g": 21.7
  }
}
```
* –£ –ø–æ–ª—ñ ingredients ‚Äî —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∞.

* –£ –ø–æ–ª—ñ total ‚Äî –∑–∞–≥–∞–ª—å–Ω–∞ –∫–∞–ª–æ—Ä—ñ–π–Ω—ñ—Å—Ç—å —ñ –ë–ñ–£ –¥–ª—è –≤—Å—å–æ–≥–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è.

* –î–∞–Ω—ñ –±–µ—Ä—É—Ç—å—Å—è –∑ Open Food Facts –∞–±–æ –∫–µ—à–æ–≤–∞–Ω–æ—ó –±–∞–∑–∏.


## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—î–∫—Ç—É NutriScan (v0.2)

```
nutriscan/
‚îú‚îÄ‚îÄ app/                       # –û—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ main.py               # –¢–æ—á–∫–∞ –≤—Ö–æ–¥—É FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ models/               # –ú–æ–¥–µ–ª—å —ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç—ñ–≤ (YOLOv8 —Ç–∞ —ñ–Ω.)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ detector.py
‚îÇ   ‚îú‚îÄ‚îÄ services/             # –õ–æ–≥—ñ–∫–∞ –ø–æ –≤–∞–≥–∞–º, –ë–ñ–£, —Ç–æ—â–æ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ nutrition.py
‚îÇ   ‚îú‚îÄ‚îÄ utils/                # –û–±—Ä–æ–±–∫–∞ –∑–æ–±—Ä–∞–∂–µ–Ω—å, –¥–æ–ø–æ–º—ñ–∂–Ω–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ image_utils.py
‚îÇ   ‚îî‚îÄ‚îÄ api/                  # –†–æ—É—Ç–∏
‚îÇ       ‚îî‚îÄ‚îÄ routes.py
‚îÇ
‚îú‚îÄ‚îÄ tests/                    # Pytest —Ç–µ—Å—Ç–∏ –Ω–∞ –≤—Å—ñ –µ—Ç–∞–ø–∏
‚îÇ   ‚îú‚îÄ‚îÄ test_upload.py
‚îÇ   ‚îú‚îÄ‚îÄ test_ingredients.py
‚îÇ   ‚îú‚îÄ‚îÄ test_api_detection.py
‚îÇ   ‚îú‚îÄ‚îÄ test_weight_estimation.py
‚îÇ   ‚îî‚îÄ‚îÄ test_nutrition_calc.py
‚îÇ
‚îú‚îÄ‚îÄ models/                   # –í–∞–≥–∏ –º–æ–¥–µ–ª–µ–π (.pt, .bin —Ç–æ—â–æ)
‚îÇ   ‚îî‚îÄ‚îÄ detector.pt
‚îÇ
‚îú‚îÄ‚îÄ scripts/                  # –°–∫—Ä–∏–ø—Ç–∏ —ñ–Ω—Å—Ç–∞–ª—è—Ü—ñ—ó/–∑–∞–ø—É—Å–∫—É
‚îÇ   ‚îú‚îÄ‚îÄ install.sh            # –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π, –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ download_models.sh    # –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤–∞–≥
‚îÇ   ‚îî‚îÄ‚îÄ run_server.sh         # –ó–∞–ø—É—Å–∫ FastAPI
‚îÇ
‚îú‚îÄ‚îÄ docs/                     # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
‚îÇ   ‚îú‚îÄ‚îÄ DEVLOG.md             # Dev-–±–ª–æ–≥ –ø–æ –µ—Ç–∞–ø–∞—Ö
‚îÇ   ‚îî‚îÄ‚îÄ INSTALL.md            # –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è
‚îÇ
‚îú‚îÄ‚îÄ .env                      # –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (—è–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ)
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ README.md
```


üìå –ö–æ–º–∞–Ω–¥–∏ –Ω–∞ –º–∞–π–±—É—Ç–Ω—î

| –î—ñ—è        | –ö–æ–º–∞–Ω–¥–∞                            |
| ---------- | ---------------------------------- |
| –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ | `sudo systemctl restart nutriscan` |
| –°—Ç–æ–ø       | `sudo systemctl stop nutriscan`    |
| –°—Ç–∞—Ç—É—Å     | `sudo systemctl status nutriscan`  |
| –õ–æ–≥–∏       | `journalctl -u nutriscan -f`       |
